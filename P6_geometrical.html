<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>p6_geometrical – HamidSDMTestWeb</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-dfb324f25d9b1687192fa8be62ac8f9c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">HamidSDMTestWeb</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./P4_logical.html"> 
<span class="menu-text">P4_logical</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./P6_geometrical.html" aria-current="page"> 
<span class="menu-text">P6_geometrical</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./P8_network.html"> 
<span class="menu-text">P8_network</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#p6-geometrical-queries" id="toc-p6-geometrical-queries" class="nav-link active" data-scroll-target="#p6-geometrical-queries">[P6] Geometrical queries</a>
  <ul class="collapse">
  <li><a href="#getting-started" id="toc-getting-started" class="nav-link" data-scroll-target="#getting-started">1. Getting started</a>
  <ul class="collapse">
  <li><a href="#how-geometries-are-stored" id="toc-how-geometries-are-stored" class="nav-link" data-scroll-target="#how-geometries-are-stored">1.1. How geometries are stored</a></li>
  </ul></li>
  <li><a href="#information-about-geometries" id="toc-information-about-geometries" class="nav-link" data-scroll-target="#information-about-geometries">2. Information about geometries</a>
  <ul class="collapse">
  <li><a href="#geometry-types-and-well-known-text" id="toc-geometry-types-and-well-known-text" class="nav-link" data-scroll-target="#geometry-types-and-well-known-text">2.1. Geometry types and Well-Known Text</a></li>
  <li><a href="#spatial-reference-systems" id="toc-spatial-reference-systems" class="nav-link" data-scroll-target="#spatial-reference-systems">2.2. Spatial reference systems</a></li>
  <li><a href="#transformations-between-spatial-reference-systems" id="toc-transformations-between-spatial-reference-systems" class="nav-link" data-scroll-target="#transformations-between-spatial-reference-systems">2.3. Transformations between spatial reference systems</a></li>
  <li><a href="#geometries-vs-geographies" id="toc-geometries-vs-geographies" class="nav-link" data-scroll-target="#geometries-vs-geographies">2.4. Geometries vs geographies</a></li>
  </ul></li>
  <li><a href="#spatial-properties-of-geometries" id="toc-spatial-properties-of-geometries" class="nav-link" data-scroll-target="#spatial-properties-of-geometries">3. Spatial properties of geometries</a>
  <ul class="collapse">
  <li><a href="#area" id="toc-area" class="nav-link" data-scroll-target="#area">3.1. Area</a></li>
  <li><a href="#perimeter-and-length" id="toc-perimeter-and-length" class="nav-link" data-scroll-target="#perimeter-and-length">3.2. Perimeter and length</a></li>
  <li><a href="#bounding-box" id="toc-bounding-box" class="nav-link" data-scroll-target="#bounding-box">3.3. Bounding box</a></li>
  </ul></li>
  <li><a href="#spatial-data-storage" id="toc-spatial-data-storage" class="nav-link" data-scroll-target="#spatial-data-storage">4. Spatial data storage</a></li>
  <li><a href="#simple-geometric-analysis" id="toc-simple-geometric-analysis" class="nav-link" data-scroll-target="#simple-geometric-analysis">5. Simple geometric analysis</a>
  <ul class="collapse">
  <li><a href="#querying-distances" id="toc-querying-distances" class="nav-link" data-scroll-target="#querying-distances">5.1. Querying distances</a></li>
  <li><a href="#buffers-and-centroids" id="toc-buffers-and-centroids" class="nav-link" data-scroll-target="#buffers-and-centroids">5.2. Buffers and centroids</a></li>
  <li><a href="#multi-geometries-geometrycollections-and-accessing-parts-of-geometries" id="toc-multi-geometries-geometrycollections-and-accessing-parts-of-geometries" class="nav-link" data-scroll-target="#multi-geometries-geometrycollections-and-accessing-parts-of-geometries">5.3. Multi* geometries / GeometryCollections and accessing parts of geometries</a></li>
  </ul></li>
  <li><a href="#extra-other-ways-of-importing-spatial-data" id="toc-extra-other-ways-of-importing-spatial-data" class="nav-link" data-scroll-target="#extra-other-ways-of-importing-spatial-data">[Extra] Other ways of importing spatial data</a>
  <ul class="collapse">
  <li><a href="#from-a-join" id="toc-from-a-join" class="nav-link" data-scroll-target="#from-a-join">From a join</a></li>
  <li><a href="#from-a-tool" id="toc-from-a-tool" class="nav-link" data-scroll-target="#from-a-tool">From a tool</a></li>
  </ul></li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources">Resources:</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<section id="p6-geometrical-queries" class="level1">
<h1>[P6] Geometrical queries</h1>
<p>This practical is the first in a series of four on spatial data retrieval, analysis and manipulation using PostgreSQL.</p>
<p>Objectives of this practical:</p>
<ul>
<li>You will be introduced to working with spatial data in an Object-Relational DBMS (PostGIS).</li>
<li>You will learn how to investigate basic spatial properties of a database’s spatial data.</li>
<li>You will perform simple geometric analysis on objects in the database.</li>
<li>You will store spatial data in the database.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>A set of SQL queries of interest enabling to demonstrate some of the content from lectures is also here: <a href="../resources/sql/sql02_intro_spatial.sql">Intro to spatial sql</a> and <a href="../resources/sql/sql03_geometrical_operations.sql">geometrical operations</a></p>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Much of the material in this practical does not make sense if you have not been following the lectures!</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>All functions starting with <code>ST_</code> are documented at the <strong><a href="https://postgis.net/docs/reference.html">PostGIS Reference</a></strong>. This will be a crucial reference for you in the next few weeks.</p>
</div>
</div>
<section id="getting-started" class="level2">
<h2 class="anchored" data-anchor-id="getting-started">1. Getting started</h2>
<p>You can execute spatial SQL queries using any PostgreSQL client, including pgAdmin. However, QGIS makes it especially easy to visualise our query’s results.</p>
<p>During today’s practical, your tutor will demonstrate how to use the QGIS DB Manager to run spatial queries and visualise the results on the map.</p>
<section id="how-geometries-are-stored" class="level3">
<h3 class="anchored" data-anchor-id="how-geometries-are-stored">1.1. How geometries are stored</h3>
<p>Spatial information represented by vector data is stored using columns of a data type <code>geometry</code>.The entire stored record (row), associating <em>n</em> attributes with (typically) a <em>single</em> geometry column, is often called a <em>feature</em>.</p>
<p>PostGIS and other DBMS allow you to store multiple geometry columns within one table (and this has all sorts of modeling advantages) but it may challenge the interaction with many traditional GIS.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="callout callout-style-default callout-tip callout-titled" title="Your Turn">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Your Turn
</div>
</div>
<div class="callout-body-container callout-body">
<p>Open pgAdmin, the QGIS DB Manager, or your preferred PostgreSQL querying tool of choice, and write SQL queries to answer the following questions:</p>
<ol type="1">
<li>Name all the tables in the <code>spatial</code> schema that contain spatial data. <strong>HINT:</strong> The geometry columns in PostGIS are listed as data type <code>USER-DEFINED</code> in the table <code>information_schema.columns</code>. Refer back to <a href=".\practicals/01b_basic_SQL_interaction.html">Practical 1b</a> if you need a refresher.</li>
<li>List the geometry type of each table in the <code>spatial</code> schema. <strong>HINT:</strong> The table (or rather, a view) <code>geometry_columns</code> (in the ‘public’ schema) is a little more informative about the geometry data types. Start with a <code>SELECT *</code> query on <code>geometry_columns</code> to see what data is available, then narrow it down to just the columns and rows required.</li>
</ol>
<p>If you get stuck on these questions, the full SQL queries are in the “Answers” box below.</p>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled" title="Answers">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answers
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Query 1:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> table_name</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> information_schema.<span class="kw">columns</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> table_schema <span class="op">=</span> <span class="st">'spatial'</span> <span class="kw">AND</span> data_type <span class="op">=</span> <span class="st">'USER-DEFINED'</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> table_name;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Query 2:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> f_table_name, <span class="kw">type</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> geometry_columns</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> f_table_schema <span class="op">=</span> <span class="st">'spatial'</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> f_table_name;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="information-about-geometries" class="level2">
<h2 class="anchored" data-anchor-id="information-about-geometries">2. Information about geometries</h2>
<p>We will find out some basic information about the types of geometries, as well as the coordinate systems used to georeference (relate to the Earth) spatial objects. We will use the state of New York (<code>us_states.state_abrv='NY'</code>) and other US states.</p>
<section id="geometry-types-and-well-known-text" class="level3">
<h3 class="anchored" data-anchor-id="geometry-types-and-well-known-text">2.1. Geometry types and Well-Known Text</h3>
<p>One of the most important pieces of information we need about a specific spatial object is what type of object it is (point, line, polygon, …).</p>
<p>This can be retrieved using the following query template, based on the PostGIS function <code>GeometryType</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> GeometryType(geom)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> spatial._______;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can also find the <a href=".\17_geometries.html#serialisation-of-geometries">Well-Known Text (WKT) representation</a> of a geometry using the <code>ST_AsText</code> PostGIS function:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> ST_AsText(geom)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> <span class="op">..</span>.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-tip callout-titled" title="Your Turn">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Your Turn
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>In the query you ran in the previous section, you may have noticed that some of the tables in the <code>spatial</code> schema, such as <code>us_rivers</code> and <code>world_countries</code>, had a defined geometry type of <code>GEOMETRY</code>. This means they can contain any geometry type. Use the <code>GeometryType</code> function to ascertain the geometry types that are actually contained within each of these tables. <strong>HINT:</strong> Use <code>SELECT DISTINCT</code> to remove duplicate values from your results.</li>
<li>Find the WKT representation of the location of all McDonald’s restaurants in the <code>us_restaurants</code> table. <strong>HINT:</strong> Because <code>'</code> has a special meaning in SQL, you need to write the restaurant name as <code>'MCDONALD''S'</code> with a double apostrophe.</li>
</ol>
</div>
</div>
</section>
<section id="spatial-reference-systems" class="level3">
<h3 class="anchored" data-anchor-id="spatial-reference-systems">2.2. Spatial reference systems</h3>
<p>We need to understand the meaning of the coordinate values encoding vertices of geometries. Without that, we are unable to interpret, e.g., the meaasurement of spatial properties such as areas and distances.</p>
<p>The SRID is a code specifying in what coordinate system spatial data are stored. Most commonly, these codes come from the EPSG database (this is often referred to as <em>authority</em>). This database is stored in the <code>spatial_ref_sys</code> table. Users can extend this table - just do not overwrite any existing SRIDs! Thus, you can create your own IDs, with your own authority, and specify a SRID with parameters you want.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Your Turn">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Your Turn
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Find out what coordinate system the geometries capturing the state of Georgia are stored in. Use the query template below:</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> ST_SRID(geom)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> spatial.us_states</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> <span class="op">..</span>.;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="2" type="1">
<li>The previous query returned an SRID. Look up this SRID in the <code>spatial_ref_sys</code> table (note, this table is part of PostGIS and is <strong>not</strong> in the <code>spatial</code> schema):</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> spatial_ref_sys</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> srid <span class="op">=</span> ____;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Can you work out the name of this SRS, and whether it is a geographic (longitude/latitude) or projected SRS? <strong>HINT:</strong> Expand your view of the <code>srtext</code> and <code>proj4text</code> columns and see if you can spot any useful details.</p>
<ol start="3" type="1">
<li>Use the resource at <a href="https://epsg.io">epsg.io</a> to find out more about this SRS.</li>
</ol>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled" title="Answers">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answers
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>The SRS is <strong>WGS 84</strong>.</li>
<li>The row in the <code>spatial_ref_sys</code> table holds useful info:
<ul>
<li>The <code>srtext</code> value starts <code>GEOGCS["WGS 84",...</code>. So it is a geographic coordinate system. The piece of text after the first <code>[</code> is the SRS name. On this case it is “WGS 84”.</li>
<li>The <code>proj4text</code> value starts <code>+proj=longlat</code>, which also tells us it is a geographic coordinate system.</li>
</ul></li>
</ul>
</div>
</div>
</div>
</section>
<section id="transformations-between-spatial-reference-systems" class="level3">
<h3 class="anchored" data-anchor-id="transformations-between-spatial-reference-systems">2.3. Transformations between spatial reference systems</h3>
<p>Often, it is necessary to transform data (for instance, during the Extract-Transform-Load process), to correlate them with other data. This may involve complex transformations (see the <a href="../16_srs_transformations.html">lecture on projections and transformations</a>).</p>
<p>Two concepts are important here: <strong>source SRS</strong> (given by SRID) and <strong>target SRS</strong>. Typically, for well stored data, a table will have geometries with an assigned SRID (as tested above). Then, this is your <strong>source SRID</strong> and you only need to specify what is the <strong>target SRID</strong> you want to transform into.</p>
<p>To transform geometries with an already assigned SRID to a target SRID:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> ST_Transform(geom, targetSRID)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> table_name;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Sometimes geometry data lacks an assigned SRID. You then need to <strong>set</strong> it for the given geometries, before you can transform:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> ST_Transform(ST_SetSRID(geom, sourceSRID), targetSRID)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> table_name;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Understanding the difference between <code>ST_SetSRID</code> and <code>ST_Transform</code> is crucial. Read the <a href="https://postgis.net/docs/ST_SetSRID.html">ST_SetSRID documentation</a> and note the difference - <code>ST_SetSRID</code> does not perform a transformation, it keeps the coordinates the same and merely overprints/adds the information about the used SRID. On the other hand, <code>ST_Transform</code> actually <em>transforms</em> the data itself.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Your Turn">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Your Turn
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>What SRID are the geometries in the <code>spatial.victoria_police_stations</code> table in? Is this a geographic or projected coordinate system?</li>
<li>Use the <code>ST_AsText</code> function to inspect the coordinates of each police station:</li>
</ol>
<div class="sourceCode" id="cb9"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> name, ST_AsText(geom)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> spatial.victoria_police_stations;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="3" type="1">
<li>Transform the coordinates of <code>'Branxholme Police Station'</code> to longitude/latitudes and display these coordinates using <code>ST_AsText</code>.</li>
<li>Search up this police station on Google Maps and right-click on the location on the map – do you see the same coordinates?</li>
</ol>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled" title="Answers">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answers
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>Remember to query the <code>spatial_ref_sys</code> table or look up <a href="https://epsg.io">epsg.io</a> to find out details about an SRID (EPSG code).</li>
<li>The longitude/latitude of Branxholme Police Station is <strong>141.798761°E 37.858406°S</strong>.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="geometries-vs-geographies" class="level3">
<h3 class="anchored" data-anchor-id="geometries-vs-geographies">2.4. Geometries vs geographies</h3>
<p>PostGIS can be told to intepret geometries stored in a geographic SRS, such as <code>EPSG:4326</code>, as <strong>geographies</strong>. It has to be explicitly told to do so! The table will then register its column in the <code>geography_columns</code>, see above. PostGIS automatically applies precise spheroidal equations to compute areas, distances and angles on geographies.</p>
<p>This implies:</p>
<pre><code>- A more limited set of functions
- More accurate
- More computationally expensive</code></pre>
<p>Users can also tell PostGIS to interpret a given geometry as a geography, by casting: <code>mygeom::geography</code></p>
</section>
</section>
<section id="spatial-properties-of-geometries" class="level2">
<h2 class="anchored" data-anchor-id="spatial-properties-of-geometries">3. Spatial properties of geometries</h2>
<p>In addition to coordinates, we can find out a variety of spatial information for our spatial data, by analysing the geometries representing the records. These values do not have to be stored as attributes, but can be computed on the fly.</p>
<p>To work with the geometries in PostGIS, you have to provide a spatial function and its parameter as arguments of the <code>SELECT</code> statement.</p>
<section id="area" class="level3">
<h3 class="anchored" data-anchor-id="area">3.1. Area</h3>
<p>Calculate the area of a <code>Polygon</code> or <code>MultiPolygon</code> geometry like this:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> ST_Area(geometry_column)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> <span class="op">..</span>.;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-tip callout-titled" title="Your Turn">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Your Turn
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Find the area of New York state. What are the units of your answer?</li>
<li>Look up the documentation for <code>ST_Area</code> on the web. Note that the function accepts a second parameter, <code>use_spheroid := true</code> or <code>use_spheroid := false</code>. Investigate what this argument does and what difference it makes to your answer.</li>
<li>Write a query to list the names of the four largest US states by area. Return the results in descending order of area (largest first). Review the <a href=".\practicals/01b_basic_SQL_interaction.html">Basic SQL Practical</a> if you need.</li>
</ol>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled" title="Answers">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answers
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>The land area of New York state is around <strong>127,000 km²</strong>.</li>
<li>The four largest US states, listed with the largest first, are <strong>Alaska</strong>, <strong>Texas</strong>, <strong>California</strong> and <strong>Montana</strong>.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="perimeter-and-length" class="level3">
<h3 class="anchored" data-anchor-id="perimeter-and-length">3.2. Perimeter and length</h3>
<p>Two related functions return the length for lines or the perimeter for polygons. The functions are <code>ST_Length(geometry_column)</code> and <code>ST_Perimeter(geometry_column)</code>. Just as with <code>ST_Area</code>, these functions both accept the <code>use_spheroid</code> parameter.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Your Turn">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Your Turn
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Find the perimeter of New York state in kilometers.</li>
<li>What is the total length of all the rivers (table <code>us_rivers</code>) that belong to the ‘Colorado’ system?</li>
</ol>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled" title="Answers">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answers
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>The perimeter of New York state is around <strong>2,500 km</strong>.</li>
<li>The total length of rivers in the Colorado system is around <strong>4,350 km</strong>.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="bounding-box" class="level3">
<h3 class="anchored" data-anchor-id="bounding-box">3.3. Bounding box</h3>
<p>Bounding boxes are an important concept in spatial data handling. They provide the extent of the object along the axes of the coordinate system.</p>
<p>The functions <code>ST_XMax(geometry)</code>, <code>ST_XMin(geometry)</code>, <code>ST_YMax(geometry)</code>, and <code>ST_YMin(geometry)</code> return the coordinates of the constituent parts of the minimum bounding rectangle (MBR) of a geometry. The function <code>ST_Envelope(geometry)</code> also provides the MBR as a geometry itself.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Your Turn">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Your Turn
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Find the MBR of New York in two different ways:
<ol type="a">
<li>First, use the <code>ST_XMax</code>, <code>ST_XMin</code>, <code>ST_YMax</code>, <code>ST_YMin</code> functions.</li>
<li>Then use the <code>ST_Envelope</code> function. Convert the geometry to the human-readable Well-Known Text (WKT) format using the <code>ST_AsText</code> function.</li>
</ol></li>
<li>Write a single SQL statement to give the minimum and maximum latitude for each state. Label the columns in your statement <code>name</code>, <code>maxlat</code>, and <code>minlat</code>.</li>
</ol>
<p><strong>HINT:</strong> Assign aliases to the outputs of the <code>SELECT</code> statement using <code>AS</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> state <span class="kw">AS</span> name, </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>       SomeFunction(<span class="kw">parameters</span><span class="op">..</span>.) <span class="kw">AS</span> maxlat,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>       <span class="op">..</span>.</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> <span class="op">..</span>.;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled" title="Answers">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answers
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src=".\figs/practicals/p06_new_york_mbr.png" class="img-fluid figure-img"></p>
<figcaption>The MBR of New York State</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="spatial-data-storage" class="level2">
<h2 class="anchored" data-anchor-id="spatial-data-storage">4. Spatial data storage</h2>
<p>You will now define and create your own table with sample spatial data. At the end of the lab, don’t forget to remove the metadata entries, drop the table and indexes.</p>
<p>In this section, you will create a table <code>petrolstation</code> with spatial data in a column called <code>location</code>. The table will contain the coordinates of three “petrol stations”, with the following coordinates:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Name</th>
<th>ID</th>
<th>Point(lon, lat)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BP</td>
<td>1</td>
<td>-0.3448, 51.5361</td>
</tr>
<tr class="even">
<td>Shell</td>
<td>2</td>
<td>-0.3921, 51.5363</td>
</tr>
<tr class="odd">
<td>Esso</td>
<td>3</td>
<td>-0.3712, 51.5324</td>
</tr>
</tbody>
</table>
<p>Use the following templates:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> petrolstation <span class="kw">VALUES</span> (<span class="op">..</span>., ST_GeomFromText(<span class="st">'POINT(x1 x2)'</span>, <span class="dv">4326</span>));</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-tip callout-titled" title="Your Turn">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Your Turn
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><strong>Create the table</strong>. When creating a vector geometry column, you can simply specify the data type as <code>geometry</code>, which allows any type of vector data. Alternatively, you can <em>optionally</em> set a constraint on the column’s geometry type: <code>geometry(Point)</code> - or even on geometry type and SRID: <code>geometry(Point, 4326)</code>.</li>
<li><strong>Insert the data into the table</strong>. Define geometries using the <code>ST_GeomFromText</code> PostGIS function. Alternatively, you can explore the functions <code>ST_Point</code> and <code>ST_MakePoint</code>. Read the PostGIS documentation, and experiment with alternative ways of creating geometries.</li>
<li><strong>Verify the creation of the table</strong> by selecting its records. Use the <code>ST_AsText</code> function to view the geometries.</li>
<li><strong>Visualise the spatial data</strong> in the table using QGIS. Where in the world are these petrol stations?</li>
</ol>
</div>
</div>
</section>
<section id="simple-geometric-analysis" class="level2">
<h2 class="anchored" data-anchor-id="simple-geometric-analysis">5. Simple geometric analysis</h2>
<p>Now we can perform some simple geometric analyses.</p>
<section id="querying-distances" class="level3">
<h3 class="anchored" data-anchor-id="querying-distances">5.1. Querying distances</h3>
<p>The distance between any geometry (point, line, or polygon) and a point can be determined using the function <code>ST_Distance</code>. Note that in the case of distance between a line or polygon and a point, the function retrieves the minimum distance.</p>
<p>For example, try the following query which will provide the distance in metres between two of the petrol stations.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> ST_Distance(a.location, b.location, use_spheroid<span class="op">:=</span><span class="kw">true</span>) </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> petrolstation a, petrolstation b </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> a.name<span class="op">=</span><span class="st">'BP'</span> <span class="kw">and</span> b.name<span class="op">=</span><span class="st">'Shell'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-tip callout-titled" title="Your Turn">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Your Turn
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Write a query to find the distances between all pairs of petrol stations.</li>
<li>Select the names of the 10 closest restaurants from the restaurant <code>poi_id = 33625120</code>(<code>us_restaurants</code> table).</li>
</ol>
</div>
</div>
<p>We can also find places that are <em>within</em> a certain distance of each other using the <code>ST_DWithin</code> function. Try the following query, inserting a range of sensible values in place of the distance <code>___</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> petrolstation a, petrolstation b</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> ST_DWithin(a.location, b.location, ___);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="buffers-and-centroids" class="level3">
<h3 class="anchored" data-anchor-id="buffers-and-centroids">5.2. Buffers and centroids</h3>
<p>A <em>buffer</em> creates a new geometry containing all the locations within a specified distance of a input geometry. Create buffers of 1 km around each of the petrol stations, using the following template:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> ST_Buffer(geometry_column, distance)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> <span class="op">..</span>.;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Again, beware of the units!</p>
<p>We can also create the centroid (center of gravity) for a polygonal shape using the following template:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> ST_Centroid(geometry) </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> <span class="op">..</span>.;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-tip callout-titled" title="Your Turn">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Your Turn
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Find the centroid of the buffer of 1000 m for the Shell petrol station. What do you notice about this centroid and why?</li>
<li>Use QGIS to visualise 1000 m buffers around all the <code>us_restaurants</code>. Are there any parts of Washington, DC that are more than 1000 m away from a restaurant?</li>
</ol>
</div>
</div>
</section>
<section id="multi-geometries-geometrycollections-and-accessing-parts-of-geometries" class="level3">
<h3 class="anchored" data-anchor-id="multi-geometries-geometrycollections-and-accessing-parts-of-geometries">5.3. Multi* geometries / GeometryCollections and accessing parts of geometries</h3>
<p>Some geometries may be of type <code>GeometryCollection</code> or <code>Multi...</code>, when there are multiple member geometries. It is then convenient to check how many geometry parts are in a multi-geometry, and to access these parts, for instance separating multi-geometries into components.</p>
<p>You can form a GeometryCollection or Multi* geometry using <code>ST_Collect</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> ST_Collect(geom)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> <span class="op">..</span>.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note this is an aggregate function (like <code>SUM</code> or <code>AVG</code>), so it will take many rows and return a single value.</p>
<p>The reverse operation – splitting a GeometryCollection out into its component parts – is done using <code>ST_Dump</code>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> (ST_Dump(geom_coll)).geom</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> <span class="op">..</span>.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can explore the part of PostGIS documentation related to GeometryCollections.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Your Turn">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Your Turn
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Use the <code>ST_Collect</code> and <code>ST_Area</code> functions to calculate the total area of all US states. Compare this with the area of the United States geometry in the <code>world_counties</code> table.</li>
<li>According to the data in the <code>world_countries</code> table, how many islands (individual polygons) is Australia made up of? Use <code>ST_Dump</code> in your SQL query to answer this question.</li>
</ol>
</div>
</div>
</section>
</section>
<section id="extra-other-ways-of-importing-spatial-data" class="level2">
<h2 class="anchored" data-anchor-id="extra-other-ways-of-importing-spatial-data">[Extra] Other ways of importing spatial data</h2>
<p>Other than creating data by hand, there are other means of creating content. This may be by modifying/computing geometrical content based on the existing content of other tables (or even the same one), parsing content from textual sources (importing text with coordinates and parsing this into e.g., points through the same processes investigated above), or importing content from GIS tools, or through ETL (Extract-Transform-Load) processes.</p>
<p>Some hints are below.</p>
<section id="from-a-join" class="level3">
<h3 class="anchored" data-anchor-id="from-a-join">From a join</h3>
<p>Data can be created from a join, based on other tables. Note that below, you could add a functions to the SQL statement <code>geom = t2.geom</code>, e.g., <code>geom = ST(centroid(t2.geom)</code>. What would that do?</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">UPDATE</span> petrolstation <span class="kw">as</span> t1</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> geom <span class="op">=</span> t2.geom </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> otherschema.pois <span class="kw">as</span> t2</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> t1.attribute1 <span class="op">=</span> t2.attribute2;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="from-a-tool" class="level3">
<h3 class="anchored" data-anchor-id="from-a-tool">From a tool</h3>
<ul>
<li><strong>From a GIS</strong>: experiment with QGIS, and try to export/save data from a shapefile into the database. This is now as easy as establishing a connection to your database in the <strong>Browser</strong> panel, and dragging some layers of data (e.g., hand digitised, or from a shapefile or similar format) from the <strong>Layers</strong> panel into the schema. Of course, you can be more nuanced.</li>
<li><strong>From an ETL</strong> (extract-transform-load) tool, e.g., FME, <a href="https://gdal.org/programs/ogr2ogr.html">GDAL.org/ogr2ogr</a> (excellent command line conversion utility). You can experiment with the tool <code>ogr2ogr</code> which is part of the QGIS installation (it is what actually powers QGIS). This is one of the most powerful tools in geospatial.</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Learn more:</strong> A detailed set of instructions for various import means is here: <a href="https://postgis.net/workshops/en/postgis-intro/loading_data.html">https://postgis.net/workshops/en/postgis-intro/loading_data.html</a></p>
</div>
</div>
</section>
</section>
<section id="resources" class="level2">
<h2 class="anchored" data-anchor-id="resources">Resources:</h2>
<ul>
<li>PostGIS documentation: <a href="https://postgis.net/documentation/">https://postgis.net/documentation/</a></li>
</ul>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>You can experiment: <a href="https://gis.stackexchange.com/questions/109599/how-to-display-a-table-with-more-than-one-geometry-column-in-qgis">QGIS behaviour</a> / <a href="https://desktop.arcgis.com/en/arcmap/latest/manage-data/using-sql-with-gdbs/rules-for-creating-spatial-tables-to-be-used-with-arcgis.htm">ArcGIS: single column, create a view</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/HamidHosseiniUniMelb\.github\.io\/HamidSDMTest\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>